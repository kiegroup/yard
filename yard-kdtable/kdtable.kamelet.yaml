apiVersion: camel.apache.org/v1alpha1
kind: Kamelet
metadata:
  name: kdtable
  labels:
    camel.apache.org/kamelet.type: "action"
spec:
  definition:
    title: "Kamelet decision table with YaRD"
    description: |-
      Experimental Kamelet processor supporting (only) YaRD's decision table.
    required:
    - kdtable
    properties:
      kdtable:
        title: kdtable
        description: the YaRD's decision table element
        type: object
      expressionLang:
        title: expressionLang
        description: can be blank
        type: string
        default: "null" # unable to use `null` in this kamelet definition, todo raise to camel-k team? 
      resultKey:
        title: resultKey
        description: can be blank
        type: string
        default: kdtable
  dependencies:
  - "camel:core"
  - "camel:kamelet"
  - "github:kiegroup.yard/yard-kdtable/camelk-SNAPSHOT" # advised by Camel-K team for multimodule projects such as YaRD. If updating snapshot, requires erase/delete the integration-kit and build on the cluster?
  template:
    beans:
      - name: mmbean
        type: '#class:org.drools.yard.kdtable.KdtableProcessor'
        properties:
          kdtable: '{{kdtable}}'
          expressionLang: '{{expressionLang}}'
          resultKey: '{{resultKey}}'
    from:
      uri: "kamelet:source"
      steps:
      - process:
          ref: '{{mmbean}}'
      - to: "log:info"
      - to: "kamelet:sink"
